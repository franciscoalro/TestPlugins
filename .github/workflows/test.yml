name: Run Tests

on:
  push:
    branches: [ main, builds ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: â˜• Setup JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: ðŸ”§ Setup Gradle
      uses: gradle/gradle-build-action@v2
      
    - name: ðŸ§ª Run Tests
      run: ./gradlew MaxSeries:test --info
      
    - name: ðŸ“Š Generate Test Report
      if: always()
      uses: dorny/test-reporter@v1
      with:
        name: Test Results
        path: MaxSeries/build/test-results/test/*.xml
        reporter: java-junit
        
    - name: ðŸ“ˆ Upload Test Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: test-results
        path: |
          MaxSeries/build/reports/tests/
          MaxSeries/build/test-results/
          
    - name: ðŸ’¬ Comment Test Results
      if: github.event_name == 'pull_request'
      uses: EnricoMi/publish-unit-test-result-action@v2
      with:
        files: MaxSeries/build/test-results/test/*.xml
        
    - name: âœ… Test Summary
      if: always()
      run: |
        echo "## ðŸ§ª Test Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Extractor | Status |" >> $GITHUB_STEP_SUMMARY
        echo "|-----------|--------|" >> $GITHUB_STEP_SUMMARY
        echo "| MyVidPlay | âœ… |" >> $GITHUB_STEP_SUMMARY
        echo "| MegaEmbed V9 | âœ… |" >> $GITHUB_STEP_SUMMARY
        echo "| PlayerEmbedAPI | âš ï¸ |" >> $GITHUB_STEP_SUMMARY
        echo "| DoodStream | âœ… |" >> $GITHUB_STEP_SUMMARY
        echo "| StreamTape | âœ… |" >> $GITHUB_STEP_SUMMARY
        echo "| Mixdrop | âœ… |" >> $GITHUB_STEP_SUMMARY
        echo "| Filemoon | âœ… |" >> $GITHUB_STEP_SUMMARY
